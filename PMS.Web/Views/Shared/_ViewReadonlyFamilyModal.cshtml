<input type="hidden" id="txtHiddenFamilyId" value="0" />
<input type="hidden" id="hiddenDomicile" value="0" />
<div id="readonlyFamilyModal" data-backdrop="static" data-keyboard="false" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="widget-box transparent">
                <div class="widget-header center">
                
                    <h4 id="readonlyFamilyTitle" class="widget-title lighter">Thêm mới gia đình</h4>
                    <div class="widget-toolbar no-border">
                        <a href="#" onclick="$('#btnCloseReadonlyFamily').click()">
                            <i class="ace-icon fa fa-times"></i>
                        </a>
                    </div>
          
                </div>
                <div class="widget-body">

                    <div class="col-sm-12  ui-sortable">
                        <div class="col-xs-12">
                            <div class="widget-box transparent ui-sortable-handle">

                                <div class="widget-header">
                                    <h4 class="widget-title lighter">Thông tin gia đình</h4>
                                </div>

                                <div class="widget-body">

                                    <div class="space-10"></div>
                                    <div class="row form-horizontal">
                                        <div class="col-xs-6">
                                            <div id="divFamilyCode" class="form-group">
                                                <label class="col-sm-4 control-label no-padding-right"> Mã gia đình </label>
                                                <div class="col-sm-8">
                                                    <input type="text" id="txtReadonlyFamilyCode" class="form-control">
                                                    <label id="lbFamilyCodeError" class="text-danger" hidden=""></label>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-4 control-label no-padding-right"> Tên gia đình </label>

                                                <div class="col-sm-8">
                                                    <input type="text" id="txtReadonlyFamilyName" class="form-control" disabled="">
                                                    <label id="lbFamilyNameError" class="text-danger" hidden=""></label>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-4 control-label no-padding-right"> Giáo họ/khu </label>

                                                <div class="col-sm-8">
                                                    <input type="text" id="cbbReadonlyFamilyCommunity" class="form-control" disabled="">
                                                    @*<select class="form-control" id="cbbReadonlyFamilyCommunity" disabled="">
                                                        <option value="0"></option>
                                                    </select>
                                                    <label id="lbFamilyCommunityError" class="text-danger" hidden=""></label>*@
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-xs-6">

                                            <div class="form-group">
                                                <label class="col-sm-4 control-label no-padding-right">Số điện thoại</label>
                                                <div class="col-sm-8">
                                                    <div class="input-group">
                                                        <span class="input-group-addon">
                                                            <i class="ace-icon fa fa-phone"></i>
                                                        </span>
                                                        <input class="form-control input-mask-phone" type="text" id="txtReadonlyFamilyPhone" disabled=""/>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label class="col-sm-4 control-label no-padding-right">Địa chỉ nhà</label>

                                                <div class="col-sm-8">
                                                    <input type="text" id="txtReadonlyFamilyAddress" class="form-control" disabled="">
                                                </div>
                                            </div>

                                            @*<div class="form-group">
                                                <label class="col-sm-4 control-label no-padding-right"></label>
                                                <div class="col-sm-8">
                                                    <label class="position-relative">
                                                        <input type="checkbox" class="ace" id="cbReadonlyFamilyIsCounted" disabled=""/>
                                                        <span class="lbl" style="color: blue"> Là gia đình không được thống kê</span>
                                                    </label>
                                                </div>
                                            </div>*@
                                        </div>

                                        <div class="col-xs-12">
                                            <div class="form-group">
                                                <label class="col-sm-2 control-label no-padding-right">Ghi chú</label>
                                                <div class="col-sm-10">
                                                    <textarea id="txtReadonlyFamilyNote" rows="3" style="resize: none" class="form-control" disabled=""></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>

                    <div class="col-sm-12  ui-sortable">
                        <div class="col-xs-12">
                            <div class="widget-box transparent ui-sortable-handle">
                                <div class="widget-header">
                                    <h4 class="widget-title lighter">Thông tin chuyển xứ</h4>
                                </div>
                                <div class="widget-body">
                                    <div class="space-10"></div>
                                    <div class="row form-horizontal">
                                        <div class="col-xs-6">
                                            <div class="form-group">
                                                <label class="col-sm-4 control-label no-padding-right"> Thông tin hiện tại  </label>
                                                <div class="col-sm-8">
                                                    <select class="form-control" id="cbbReadonlyFamilyDomicileStatus" disabled="">
                                                        <option value="0">Ở tại xứ</option>
                                                        <option value="1">Chuyển từ xứ khác đến</option>
                                                        <option value="2">Đã chuyển đi xứ khác</option>
                                                    </select>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="col-xs-6">
                                            <div hidden="" id="divReadonlyFamilyDomicile" class="form-group">
                                                <label class="col-sm-4 control-label no-padding-right"> Giáo xứ </label>
                                                <div class="col-sm-8">
                                                    <input type="text" id="txtReadonlyFamilyDomicilePlace" class="form-control" disabled="">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-12  ui-sortable">
                        <div class="col-xs-12">
                            <div class="widget-box transparent ui-sortable-handle">
                                <div class="widget-header">
                                    <h4 class="widget-title lighter">Danh sách thành viên gia đình</h4>
                                </div>

                                <div class="widget-body">

                                    <div class="space-10"></div>
                                    <div class="row form-horizontal">

                                        <div class="col-xs-12">
                                            
                                            <div class="form-group">
                                                <table id="tblReadonlyFamilyMember" class="table table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th class="hidden"></th>
                                                            <th>Mã giáo dân</th>
                                                            <th>Tên giáo dân</th>
                                                            <th>Quan hệ</th>
                                                            <th>Giới tính</th>
                                                            <th>Ngày sinh</th>
                                                            <th>Thao tác</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xs-12">
                            <div class="col-sm-12">
                                <div class="align-right">

                                    <button id="btnCloseReadonlyFamily" class="btn btn-default">
                                        <i class="ace-icon fa fa-times  bigger-110"></i>
                                        Đóng
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="space-6"></div>
                    <div class="clearfix"></div>
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
</div>
@Html.Partial("_ViewReadonlyParishionerModal")
<script>
    
    //loadReadonlyParishionerCommunity();

    //function loadReadonlyParishionerCommunity() {

    //    $.ajax({
    //        url: "/Parishioner/LoadCommunityAndParishDivisionTreeView",
    //        data: {},
    //        success: function (data) {
    //            var element = $("#cbbReadonlyFamilyCommunity");
    //            element.html(data);
    //        }
    //    });

    //}
    
    function loadReadonlyFamilyById(id) {
        var domicile = $("#hiddenDomicile").val();
        startLoading();
        $.ajax({
            url: "/Family/GetFamilyById",
            type: "POST",
            data: { id: id },
            success: function (data) {
                var item = data.result;
                if (item) {

                    $("#txtReadonlyFamilyCode").val(item.Code);
                    $("#txtReadonlyFamilyCode").attr('readonly', true);
                    $("#txtReadonlyFamilyCode").show();

                    $("#txtHiddenFamilyId").val(item.Id);
                    $("#txtReadonlyFamilyName").val(item.Name);
                    $("#cbbReadonlyFamilyCommunity").val(data.communityName);
                    //$("#cbbReadonlyFamilyCommunity").change();

                    $("#txtReadonlyFamilyPhone").val(item.Phone);
                    $("#txtReadonlyFamilyAddress").val(item.Address);
                    $("#cbReadonlyFamilyIsCounted").prop("checked", (item.IsCounted ? false : true));
                    $("#txtReadonlyFamilyNote").val(item.Note);

                    if (domicile == 1) {
                        $("#cbbReadonlyFamilyDomicileStatus").val(1);
                        $("#cbbReadonlyFamilyDomicileStatus").change();
                        $("#txtReadonlyFamilyDomicilePlace").val(data.parishName);
                    } else {
                        $("#cbbReadonlyFamilyDomicileStatus").val(item.DomicileStatus);
                        $("#cbbReadonlyFamilyDomicileStatus").change();
                        $("#txtReadonlyFamilyDomicilePlace").val(item.DomicilePlace);
                    }
                    

                    $("#readonlyFamilyTitle").text("Thông tin chi tiết gia đình");
                    refreshReadonlyFamilyMemberTable();
                    $("#actionModalStatistic").val(1);
                    $("#readonlyFamilyModal").modal('show');

                } else {

                }
            },
        });

    }

    function refreshReadonlyFamilyMemberTable() {
        var id = $("#txtHiddenFamilyId").val();
        $.ajax({
            url: "/Family/GetReadonlyFamilyMembersByFamilyId",
            data: {
                id: id
            },
            success: function (data) {

                $("#tblReadonlyFamilyMember").dataTable().fnDestroy();
                $("#tblReadonlyFamilyMember > tbody").html(data);
                initSimpleReadonlyFamilyMember("tblReadonlyFamilyMember");

            }
        });
    }

    function initSimpleReadonlyFamilyMember(id) {

        $("#" + id).dataTable({
            "bDestroy": true,
            "oLanguage": {
                "sSearch": "Mã giáo dân/ Tên giáo dân",
                "sZeroRecords": "Không có dữ liệu phù hợp",
                "sInfo": "Hiển thị từ _START_ đến _END_ trên tổng số _TOTAL_ dòng",
                "sEmptyTable": "Không có dữ liệu",
                "sInfoFiltered": " - lọc ra từ _MAX_ dòng",
                "sLengthMenu": "Hiển thị _MENU_ dòng",
                "sProcessing": "Đang xử lý...",
                "sInfoEmpty": "",
                "oPaginate": {
                    "sPrevious": "Trước",
                    "sNext": "Sau"
                }
            },
            "aoColumnDefs": [

                {
                     "aTargets": [2],
                     "sWidth": "25%",
                },
                {
                     "aTargets": [1, 3, 4, 5, 6],
                     "sWidth": "15%",
                },
                {
                    "aTargets": [6],
                    "bSortable": false,
                }
            ],
            "bAutoWidth": false,
        });

    }

    $("#btnCloseReadonlyFamily").click(function () {
        $("#readonlyFamilyModal").modal('hide');
     
        clearReadonlyFamilyModal();
        $("#actionModalStatistic").val(0);
    });

    function clearReadonlyFamilyModal() {

        $("#txtHiddenFamilyId").val(0);
        $("#txtReadonlyFamilyCode").val("");
        $("#txtReadonlyFamilyCode").attr('readonly', true);
        $("#txtReadonlyFamilyCode").hide();

        $("#cbbReadonlyFamilyCommunity").val(0);
        $("#cbbReadonlyFamilyCommunity").change();

        $("#txtReadonlyFamilyName").val("");
        $("#txtReadonlyFamilyPhone").val("");
        $("#txtReadonlyFamilyAddress").val("");
        $("#txtReadonlyFamilyNote").val("");
        $("#cbReadonlyFamilyIsCounted").prop("checked", false);
        $("#cbbReadonlyFamilyDomicileStatus").val(0);
        $("#txtReadonlyFamilyDomicilePlace").val("");

        //    $("#btnAddFamily").show();

        $("#tblReadonlyFamilyMember").dataTable().fnDestroy();
        $("#tblReadonlyFamilyMember > tbody").html("");
    }
    $("#cbbReadonlyFamilyDomicileStatus").change(function () {
        var status = $(this).val();
        if (status == 0) {
            $("#divReadonlyFamilyDomicile").hide();
        } else {
            $("#divReadonlyFamilyDomicile").show();
        }
    });

    $("#viewReadonlyParishionerModal").on('hidden.bs.modal', function () {

        //-------------
        makeScrollForModal();
    });
</script>